<svelte:options tag="lite-emoji-picker" />
<section
  class="lep-picker {resolvedDarkMode ? 'lep-dark' : 'lep-light'}"
  aria-label={i18n.regionLabel}
  bind:this={rootElement}
  style="--lep-num-columns: {numColumns};"
>
  <div class="lep-search-row">
    <div class="lep-search-wrapper"
         role="combobox"
         aria-expanded={searchMode && currentEmojis.length}
         aria-owns="lep-search-results"
         aria-haspopup="listbox"
         aria-label={i18n.search}
    >
      <input
        id="lep-search"
        class="lep-search"
        type="text"
        placeholder={i18n.search}
        autocapitalize="none"
        spellcheck="true"
        aria-controls="lep-search-results"
        aria-autocomplete="list"
        aria-activedescendant={activeSearchItem === -1 ? '' : `lep-emoji-${currentEmojis[activeSearchItem].unicode}`}
        bind:value={rawSearchText}
        on:keydown={onSearchKeydown}
      >
      <label class="lep-sr-only" for="lep-search">{i18n.search}</label>
    </div>
    <button class="lep-emoji lep-skintone-button" aria-label={i18n.skinToneLabel}>üëç</button>

  </div>
  <div class="lep-nav"
       role="tablist"
       style="grid-template-columns: repeat({categories.length}, 1fr);"
       aria-label={i18n.categoriesLabel}>
    {#each categories as category (category.group)}
      <button role="tab"
              class="lep-nav-button"
              aria-controls="lep-tab-{category.group}"
              aria-label={i18n.categories[category.name]}
              aria-selected={currentCategory.group === category.group}
              title={i18n.categories[category.name]}
              on:click={() => handleCategoryClick(category)}>
        <div class="lep-emoji">
          {category.emoji}
        </div>
      </button>
    {/each}
  </div>
  <div class="lep-indicators"
       aria-hidden="true">
    {#each categories as category (category.group)}
      <div class="lep-indicator {currentCategory.group === category.group ? '' : 'lep-hidden'}">
      </div>
    {/each}
  </div>
  <div class="lep-tabpanel"
       role={searchMode ? 'listbox' : 'tabpanel'}
       aria-label={searchMode ? i18n.searchResultsLabel : i18n.categories[currentCategory.name]}
       id={searchMode ? 'lep-search-results' : `lep-tab-${currentCategory.group}`}
  >
      <div class="lep-emoji-menu"
           role={searchMode ? '' : 'menu'}>
        {#each currentEmojis as emoji, i (emoji.unicode)}
          <button role={searchMode ? 'option' : 'menuitem'}
                  aria-selected={searchMode && i === activeSearchItem}
                  class="lep-tabpanel-emoji lep-emoji {searchMode && i === activeSearchItem ? 'lep-active-search-item' : ''}"
                  id="lep-emoji-{emoji.unicode}">
            {emoji.unicode}
          </button>
        {/each}
        <!-- Render placeholders to make sure that the grid spacing looks correct. There may be a better way. -->
        {#each placeholders as placeholder}
          <div class="lep-emoji lep-hidden"></div>
        {/each}
    </div>
  </div>
  <div aria-hidden="true" class="lep-hidden lep-abs-pos">
    <button class="lep-emoji lep-baseline-emoji" bind:this={baselineEmoji}>üòÄ</button>
  </div>
</section>