<svelte:options tag={null} />
<section
  class="picker"
  aria-label={i18n.regionLabel}
  style="--num-categories: {categories.length}; --indicator-opacity: {searchMode ? 0 : 1};"
  bind:this={rootElement}
>
  <div class="search-row">
    <div class="search-wrapper"
         role="combobox"
         aria-expanded={!!(searchMode && currentEmojis.length)}
         aria-controls="search-results"
         aria-haspopup="listbox"
         aria-label={i18n.search}
    >
      <input
        id="search"
        class="search"
        type="text"
        placeholder={i18n.search}
        autocapitalize="none"
        spellcheck="true"
        aria-controls="search-results"
        aria-autocomplete="list"
        aria-activedescendant={activeSearchItem === -1 ? '' : `emoji-${currentEmojis[activeSearchItem].unicode}`}
        bind:value={rawSearchText}
        on:keydown={onSearchKeydown}
      >
      <label class="sr-only" for="search">{i18n.search}</label>
    </div>
    <button class="emoji {skintonePickerExpanded ? 'hide-focus' : ''}"
            aria-label={i18n.skinToneLabel}
            aria-haspopup="listbox"
            aria-expanded={skintonePickerExpanded}
            aria-controls="skintone-list"
            on:click={onClickSkintoneButton}
            on:keydown={onSkintoneKeydown}>{skinToneText}</button>
    {#if skintonePickerExpanded}
      <div id="skintone-list"
           class="skintone-list"
           role="listbox"
           tabindex="-1"
           aria-label={i18n.skinTonesTitle}
           aria-activedescendant="skintone-{activeSkinTone}"
      >
        {#each skinTones as skinTone, i (skinTone)}
          <button id="skintone-{i}"
                  class="emoji {i === activeSkinTone ? 'active' : ''}"
                  aria-label={i18n.skinTones[i]}
                  aria-selected={i === activeSkinTone}
                  role="option"
                  tabindex="-1"
                  on:click={() => onClickSkinTone(i)}>
            {skinTone}
          </button>
        {/each}
      </div>
    {/if}

  </div>
  <div class="nav"
       role="tablist"
       style="grid-template-columns: repeat({categories.length}, 1fr);"
       aria-label={i18n.categoriesLabel}
       on:keydown={onNavKeydown}>
    {#each categories as category (category.group)}
      <button role="tab"
              class="nav-button"
              aria-controls="tab-{category.group}"
              aria-label={i18n.categories[category.name]}
              aria-selected={currentCategory.group === category.group}
              title={i18n.categories[category.name]}
              on:click={() => handleCategoryClick(category)}>
        <div class="emoji">
          {category.emoji}
        </div>
      </button>
    {/each}
  </div>
  <div class="indicator-wrapper"
       aria-hidden="true">
    <div class="indicator"
         style={indicatorStyle}
         use:calculateWidth>
    </div>
  </div>
  {#if message}
    <div class="message">{message}</div>
  {:else}
    <div class="tabpanel"
         role={searchMode ? 'region' : 'tabpanel'}
         aria-label={searchMode ? i18n.searchResultsLabel : i18n.categories[currentCategory.name]}
         id={searchMode ? '' : `tab-${currentCategory.group}`}
         tabindex="0"
         on:click={onEmojiClick}
    >
        <div class="emoji-menu"
             role={searchMode ? 'listbox' : 'menu'}
             aria-label={searchMode ? i18n.searchResultsLabel : i18n.categories[currentCategory.name]}
             id="search-results"
        >
          {#each currentEmojis as emoji, i (emoji.unicode)}
            <button role={searchMode ? 'option' : 'menuitem'}
                    aria-selected={searchMode && i === activeSearchItem}
                    class="tabpanel-emoji emoji {searchMode && i === activeSearchItem ? 'active' : ''}"
                    id="emoji-{emoji.unicode}">
              {emoji.unicode}
            </button>
          {/each}
      </div>
    </div>
  {/if}
  <div aria-hidden="true" class="hidden abs-pos">
    <button class="emoji baseline-emoji" bind:this={baselineEmoji}>ðŸ˜€</button>
  </div>
</section>